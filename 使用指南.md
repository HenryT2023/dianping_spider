# 大众点评爬虫项目使用指南

## 🎯 项目概述
这是一个大众点评数据爬取工具，可以爬取店铺信息、详情和评论数据。

## 🚀 快速开始

### 1. 激活环境
```bash
conda activate dianping_spider
cd /Users/hal/Documents/GitHub/dianping_spider
```

### 2. 配置Cookie（重要）
由于反爬机制，需要配置有效的Cookie：

#### 方法一：使用手动输入工具
```bash
python manual_cookie_input.py
```
然后按照提示从浏览器获取Cookie并输入。

#### 方法二：手动编辑配置文件
1. 访问 https://www.dianping.com
2. 按F12打开开发者工具 → Network标签页
3. 刷新页面，点击第一个请求
4. 在Request Headers中复制Cookie值
5. 编辑 `config.ini` 文件，更新Cookie行

### 3. 运行爬虫

#### 完整爬取流程（搜索→详情→评论）
```bash
python main.py --normal 1
```

#### 仅爬取店铺详情
```bash
python main.py --detail 1 --shop_id 店铺ID
```

#### 仅爬取店铺评论
```bash
python main.py --review 1 --shop_id 店铺ID
```

## ⚙️ 配置说明

### 主要配置项（config.ini）
- `keyword`: 搜索关键词（默认：自助餐）
- `location_id`: 城市代码（8=大连，1=上海，2=北京，4=广州）
- `need_pages`: 爬取页数（默认：5页）
- `save_mode`: 保存方式（mongo/csv）
- `requests_times`: 请求间隔设置

### MongoDB配置
- 服务状态检查：`brew services list | grep mongodb`
- 启动服务：`brew services start mongodb/brew/mongodb-community`
- 查看数据：`mongosh --eval "use dianping; db.getCollectionNames()"`

## 🛠️ 工具脚本

### Cookie相关
- `cookie_helper.py`: 自动获取Cookie（可能受网络限制）
- `manual_cookie_input.py`: 手动输入Cookie工具

### 数据查看
```bash
# 查看MongoDB中的数据
mongosh
use dianping
show collections
db.your_collection.find().limit(5)
```

## 🔧 常见问题

### 1. Cookie失效
**现象**: 提示"cookie失效或者被限制访问"
**解决**: 重新获取Cookie并更新配置

### 2. MongoDB连接失败
**现象**: MongoDB相关警告
**解决**: 
```bash
brew services start mongodb/brew/mongodb-community
```

### 3. 网络请求失败
**现象**: 502错误或连接超时
**解决**: 
- 检查网络连接
- 使用代理（在config.ini中配置）
- 调整请求间隔时间

### 4. 数据保存问题
**现象**: 数据未保存
**解决**: 确认MongoDB服务运行，检查数据库连接配置

## 📊 数据结构

### 搜索结果数据
- 店铺ID、名称、地址
- 评分、价格、分类
- 位置信息

### 详情数据
- 详细店铺信息
- 营业时间、电话
- 图片、菜单等

### 评论数据
- 用户评论内容
- 评分、时间
- 用户信息

## 🚨 注意事项

1. **遵守robots.txt**: 请合理使用，不要过度频繁请求
2. **Cookie更新**: Cookie会定期失效，需要及时更新
3. **反爬机制**: 遇到验证码时需要手动处理
4. **数据使用**: 仅供学习研究使用，请勿用于商业用途

## 📝 日志查看
项目运行日志保存在 `dianping.log` 文件中，可以查看详细的运行信息和错误。

## 🔄 项目更新
如需更新项目依赖：
```bash
conda activate dianping_spider
pip install -r requirements.txt --upgrade
```

---
*最后更新: 2025-09-17*
